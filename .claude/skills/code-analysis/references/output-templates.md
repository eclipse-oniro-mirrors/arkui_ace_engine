# 输出模板

本文档提供各种分析场景的标准输出模板。

---

## 1. 快速分析模板

### 模板结构

```markdown
### [分析主题]

**分析目标**: [用户提出的具体问题]

**代码定位**:
- 文件: `[path/to/file.cpp]`
- 行号: `[line:line-range]`

**核心发现**:
- 发现点1: [描述] - `file:line`
  ```cpp
  // 代码片段
  ```
- 发现点2: [描述] - `file:line`
  ```cpp
  // 代码片段
  ```

**潜在问题**: [如有]
- 问题1: [描述] - `file:line`

**改进建议**: [如有]
- 建议1: [具体可执行的改进]

**相关知识库**: [如有]
- [知识库文档链接]
```

### 使用示例

```markdown
### TextPattern OnModifyDone 内存管理分析

**分析目标**: 分析 TextPattern 的 OnModifyDone 方法的内存管理是否合理

**代码定位**:
- 文件: `frameworks/core/components_ng/pattern/text/text_pattern.cpp`
- 行号: `234-256`

**核心发现**:
- ✅ 使用弱引用避免循环引用 - `text_pattern.cpp:235`
  ```cpp
  auto weak = AceType::WeakClaim(this);
  ```
- ✅ 在回调中检查弱引用提升结果 - `text_pattern.cpp:236-238`
  ```cpp
  auto pattern = weak.Upgrade();
  if (pattern) {
      pattern->OnDirtyLayoutWrapperSwap();
  }
  ```

**潜在问题**: 无

**改进建议**: 当前实现已遵循最佳实践，无需改进
```

---

## 2. 全面分析模板

### 模板结构

```markdown
# [组件/功能] 全面分析

## 分析目标

对 [组件名] 进行全面分析，重点关注：
- [x] 代码架构与设计模式
- [x] 生命周期管理
- [x] 内存管理与性能
- [x] 错误处理与边界情况
- [x] API 设计与使用规范
- [x] 测试覆盖情况

## 代码定位

**核心文件**:
- Pattern: `[path]`
- Model: `[path]`
- LayoutAlgorithm: `[path]`
- Tests: `[path]`

## 架构设计

### 类继承关系
```
[可视化图表]
```

### Pattern/Model/Property 分离
- ✅ Pattern 层: [描述] - `file:line`
- ✅ Model 层: [描述] - `file:line`
- ✅ Layout Property: [描述] - `file:line`

## 内存安全

### 智能指针使用
- ✅ 正确使用: [描述] - `file:line`
- ⚠️ 潜在问题: [描述] - `file:line`

### 内存泄漏风险
- [问题分析]

## 性能考量

### 算法复杂度
- 当前实现: [复杂度] - `file:line`
- 性能影响: [描述]

### 优化机会
- [优化建议]

## 错误处理

### 空指针检查
- ✅ 已实现: [描述] - `file:line`
- ❌ 缺失: [描述] - `file:line`

### 边界条件
- [分析]

## 测试覆盖

### 单元测试
- 文件: `[path]`
- 覆盖率: [百分比]

### 缺失测试
- [缺失场景]

## 问题清单

### 严重问题
1. **[问题描述]** - `file:line`
   - 影响: [描述]
   - 修复: [修复方案]

### 中等问题
[同上]

### 轻微问题
[同上]

## 改进建议

1. **[建议标题]** - `file:line`
   ```cpp
   // 修复前
   [代码]

   // 修复后
   [代码]
   ```
   - 必要性: [描述]
   - 影响: [描述]

## 可视化图表

### 类继承关系
```
[图表]
```

### 函数调用流程
```
[图表]
```
```

---

## 3. Bug 分析模板

### 模板结构

```markdown
# Bug 分析: [Bug描述]

## 复现路径
1. [操作步骤1]
2. [操作步骤2]
3. [观察到的错误]

## Bug 定位

**Bug 位置**: `[file.cpp:line]`

**问题代码**:
```cpp
// 问题代码
```

## 根本原因

[具体原因分析]

### 触发条件
- [条件1]
- [条件2]

### 影响范围
- 严重性: 高/中/低
- 触发频率: 总是/偶发/罕见
- 影响版本: [版本信息]

## 修复方案

### 修复代码
```cpp
// 修复前
[原始代码]

// 修复后
[修复后代码]
```

### 修复原理
[说明修复如何解决问题]

## 验证方法

1. [验证步骤1]
2. [验证步骤2]
3. [预期结果]

## 相关检查

使用 Grep 搜索类似问题:
```bash
[搜索命令]
```

发现类似问题:
- [问题1] - `file:line`
- [问题2] - `file:line`

建议一并修复。
```

---

## 4. 性能分析模板

### 模板结构

```markdown
# 性能分析: [组件/功能]

## 分析目标
- [ ] 布局性能
- [ ] 渲染性能
- [ ] 内存占用
- [ ] CPU 使用率

## 性能瓶颈

### 瓶颈1: [描述]
**位置**: `file:line`
**当前复杂度**: O(n)
**性能影响**: [描述]

**问题代码**:
```cpp
// 性能问题代码
```

### 瓶颈2: [描述]
[同上]

## 优化方案

### 优化1: [描述]
**问题点**: `file:line`
**当前复杂度**: O(n)
**优化方案**: [具体方案]
**预期收益**: [性能提升预估]

**优化代码**:
```cpp
// 优化前
[代码]

// 优化后
[代码]
```

## 性能测试

### 测试场景
1. [场景1]
2. [场景2]

### 测试结果
- 优化前: [数据]
- 优化后: [数据]
- 提升: [百分比]

## 建议
[后续优化方向]
```

---

## 5. API 审查模板

### 模板结构

```markdown
# API 审查: [API名称]

## API 定义

**C++ 实现**: `file.cpp:line`
**TypeScript 定义**: `path/to/api.d.ts`

## 审查维度

### ✅ API 命名
- [x] 符合命名规范
- [x] 语义清晰

### ⚠️ 参数设计
- [x] 参数类型合理
- ❌ 缺少必填参数校验 - `file:line`

### ✅ 返回值类型
- [x] 类型恰当
- [x] 错误处理完善

### ❌ 文档完整性
- ❌ 缺少 JSDoc 注释
- ❌ 缺少使用示例

## 一致性检查

### 与已有 API 对比
- ✅ 参数顺序一致
- ✅ 返回值类型一致
- ⚠️ 命名风格不一致（其他用 camelCase，此用 PascalCase）

### 向后兼容性
- ✅ 不影响现有 API
- [ ] 需要标注废弃（如有）

## 改进建议

1. **添加 JSDoc 注释**
   ```typescript
   /**
    * @brief Brief description
    * @param paramName - Parameter description
    * @returns Return value description
    * @example
    * // Usage example
    */
   ```

2. **添加参数校验** - `file:line`
   ```cpp
   if (param < 0) {
       LOGE("Invalid parameter: %{public}d", param);
       return;
   }
   ```

## 测试覆盖
- [ ] API 基本功能测试
- [ ] 边界条件测试
- [ ] 错误处理测试
```

---

## 6. 测试分析模板

### 模板结构

```markdown
# 测试分析: [组件/功能]

## 测试现状

### 现有测试文件
- `test1.cpp` - [描述]
- `test2.cpp` - [描述]

### 测试用例统计
- 总用例数: [数量]
- 覆盖的函数: [列表]
- 覆盖率: [百分比]

## 覆盖分析

### 已覆盖的关键路径
- [x] 路径1 - `test.cpp:line`
- [x] 路径2 - `test.cpp:line`

### 未覆盖的分支
- ❌ 分支1: [描述] - `source.cpp:line`
- ❌ 分支2: [描述] - `source.cpp:line`

## 缺失的测试场景

### 场景1: [具体描述]
**代码位置**: `file.cpp:line`
**重要性**: 高/中/低

**测试用例建议**:
```cpp
/**
 * @tc.name: TestName
 * @tc.desc: Description
 * @tc.type: FUNC
 */
HWTEST_F(ComponentTest, TestScenario, TestSize.Level1)
{
    // 1. Setup
    // 2. Execute
    // 3. Verify
}
```

### 场景2: [具体描述]
[同上]

## 边界条件测试

### 缺失的边界测试
- [ ] 场景: [描述]
- [ ] 场景: [描述]

## 测试用例建议

### 高优先级
1. [用例1] - 原因: [重要性]
2. [用例2] - 原因: [重要性]

### 中优先级
[列表]

### 低优先级
[列表]

## 测试覆盖率提升建议

1. **补充分支覆盖**
   - [分支1] - `file.cpp:line`
   - [分支2] - `file.cpp:line`

2. **添加边界条件测试**
   - [场景]

3. **集成测试**
   - [场景]
```

---

## 7. Markdown 格式规范

### 代码引用格式

```markdown
✅ 正确:
`file.cpp:line`
`file.cpp:line-start-line-end`

❌ 错误:
file.cpp
在 file.cpp 的第 234 行
```

### 代码块格式

```markdown
✅ 正确:
```cpp
// C++ code
int value = 42;
```

```typescript
// TypeScript code
let value: number = 42;
```

❌ 错误:
```
int value = 42;
```
```

### 问题分级格式

```markdown
### 严重问题
1. **[标题]** - `file:line`
   - 影响: [描述]
   - 修复: [方案]

### 中等问题
[同上]

### 轻微问题
[同上]
```

### 图表格式

```markdown
### 类继承关系
```
    Base
      │
      │ inherits
      │
    Derived
```

### 函数调用流程
```
FunctionA()
    ↓
FunctionB()
    ↓
FunctionC()
```
```

---

## 8. 输出质量标准

### 优秀标准
- ✅ 所有代码引用使用 `file:line` 格式
- ✅ 提供完整的代码片段
- ✅ 包含可视化图表
- ✅ 问题按严重程度分级
- ✅ 改进建议具体可执行
- ✅ 交叉验证知识库文档
- ✅ Markdown 格式规范

### 合格标准
- ✅ 核心检查项通过（代码引用、代码支撑、工具验证）
- ⚠️ 部分可选项缺失（如可视化图表）

### 不合格标准
- ❌ 缺少代码位置引用
- ❌ 有未经证实的结论
- ❌ 格式混乱
- ❌ 缺少可执行建议
```

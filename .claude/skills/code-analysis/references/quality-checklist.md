# 质量检查清单

## 提交前必检项

在提交代码分析结果前，必须完成以下检查：

---

## 1. 代码引用检查

### ✅ 所有代码引用都标注了 `file:line`

**检查方法**：
- [ ] 每个代码位置都有完整的文件路径
- [ ] 每个代码位置都有具体的行号
- [ ] 格式统一为 `path/to/file.cpp:line` 或 `path/to/file.cpp:line-start-line-end`

**示例**：
```
✅ 正确：
- OnModifyDone 实现：`text_pattern.cpp:234-256`
- 类定义：`text_pattern.h:45`

❌ 错误：
- OnModifyDone 在 text_pattern.cpp 中
- text_pattern.cpp:234
```

### ✅ 所有行号都经过验证

**验证方法**：
```bash
# 使用 Read 工具验证行号
Read: frameworks/core/components_ng/pattern/text/text_pattern.cpp (offset: 230, limit: 30)
```

---

## 2. 代码支撑检查

### ✅ 所有结论都有实际代码支撑

**检查方法**：
- [ ] 每个结论都引用了代码位置
- [ ] 提供了关键代码片段
- [ ] 代码片段来自实际源文件

**示例**：
```
✅ 正确：
**结论**: TextPattern 使用弱引用避免循环引用
**代码**: text_pattern.cpp:235
```cpp
auto weak = AceType::WeakClaim(this);
```

❌ 错误：
**结论**: TextPattern 使用弱引用避免循环引用
（无代码引用）
```

### ✅ 禁止使用不确定词汇

**检查方法**：
- [ ] 没有"推测"、"可能"、"大概"等词汇
- [ ] 如使用推测，必须明确标注为"（推测）"
- [ ] 推测内容必须说明依据

**示例**：
```
✅ 正确：
基于 `text_pattern.cpp:235` 的分析，TextPattern 使用弱引用避免循环引用

⚠️ 有标注推测：
基于 `text_pattern.cpp:235` 的实现，推测 OnModifyDone 在以下情况下会被调用...（推测）

❌ 错误：
TextPattern 可能使用了弱引用
```

---

## 3. 改进建议检查

### ✅ 提供了具体可执行的改进建议

**检查方法**：
- [ ] 建议具体到代码级别
- [ ] 提供了修复前后的对比代码
- [ ] 说明了修复的必要性

**示例**：
```
✅ 正确：
**问题**: `grid_layout_algorithm.cpp:189` 存在不必要的值拷贝
**影响**: 每次调用都会拷贝 GridCellInfo 对象，影响性能
**修复方案**:
```cpp
// 修复前
GridCellInfo info = GetCellInfo(index);

// 修复后
const GridCellInfo& info = GetCellInfo(index);
```

❌ 错误：
**问题**: 性能问题
**建议**: 优化性能
```

### ✅ 建议优先级明确

**检查方法**：
- [ ] 问题按严重程度分级（严重/中等/轻微）
- [ ] 明确标注影响范围
- [ ] 提供修复优先级建议

**分级标准**：
- **严重**: 可能导致崩溃、内存泄漏、安全漏洞
- **中等**: 性能问题、逻辑错误、边界条件
- **轻微**: 代码规范、可读性、维护性

---

## 4. 可视化输出检查

### ✅ 包含了可视化图表（如适用）

**检查方法**：
- [ ] 类继承关系图（架构分析）
- [ ] 函数调用流程图（复杂逻辑）
- [ ] 数据流向图（数据流转分析）

**示例**：
```
✅ 类继承关系图：
```
                    Pattern
                       │
                       │ inherits
                       │
              ScrollablePattern
                       │
                       │ inherits
                       │
                   GridPattern
```
```

### ✅ 图表清晰准确

**检查方法**：
- [ ] 图表基于实际代码绘制
- [ ] 继承关系准确
- [ ] 调用流程符合实际

---

## 5. 知识库验证检查

### ✅ 交叉验证了相关知识库文档

**检查方法**：
- [ ] 查询 `docs/` 下是否有相关知识库
- [ ] 对比知识库与实际代码
- [ ] 引用知识库中的相关内容

**验证步骤**：
```bash
# Step 1: 查找知识库
Glob: "docs/pattern/text/*.md"

# Step 2: 读取知识库
Read: docs/pattern/text/Text_Knowledge_Base_CN.md

# Step 3: 对比实际代码
Grep: "OnModifyDone" frameworks/core/components_ng/pattern/text/
```

### ✅ 发现不一致时及时说明

**检查方法**：
- [ ] 发现文档与代码不一致时明确标注
- [ ] 提供正确的代码位置
- [ ] 建议更新文档

**示例**：
```
**不一致发现**:
文档描述：OnModifyDone 在 `text_pattern.cpp:299` 调用 UpdateBorderRadius
实际代码：OnModifyDone 在 `text_pattern.cpp:303` 调用 UpdateBorderRadius（代码已重构）

**建议**: 更新 Text_Knowledge_Base_CN.md 文档
```

---

## 6. 工具使用检查

### ✅ 使用了 Read/Grep 工具验证

**检查方法**：
- [ ] 所有代码位置都用 Read 验证过
- [ ] 所有方法名都用 Grep 搜索过
- [ ] 没有基于假设的结论

**验证示例**：
```bash
# ❌ 错误：直接假设
"TextPattern 有一个 OnModifyDone 方法"

# ✅ 正确：先搜索验证
Grep: "OnModifyDone" frameworks/core/components_ng/pattern/text/
# 结果：text_pattern.cpp:234
```

### ✅ 禁止跳过代码验证

**检查清单**：
- [ ] 没有说"应该是这样的"
- [ ] 没有说"一般情况下"
- [ ] 所有代码结论都基于实际读取

---

## 7. 相关组件检查

### ✅ 检查了相关组件的实现模式

**检查方法**：
- [ ] 对比了类似组件的实现
- [ ] 参考了最佳实践
- [ ] 检查了一致性

**对比示例**：
```
**对比分析**:
- Text 组件：使用 `RefPtr` 管理生命周期
- Button 组件：使用 `RefPtr` 管理生命周期
- 当前组件：✅ 使用 `RefPtr` 管理生命周期

**结论**: 符合 NG 架构规范
```

---

## 8. 输出格式检查

### ✅ 输出结构清晰

**检查清单**：
- [ ] 有明确的章节标题
- [ ] 使用了 Markdown 格式
- [ ] 代码块使用语法高亮
- [ ] 代码位置使用引用格式

### ✅ 语言简洁专业

**检查清单**：
- [ ] 避免冗余描述
- [ ] 使用技术术语准确
- [ ] 中文表达流畅

---

## 完整检查清单速查表

提交前快速检查：

- [ ] **代码引用**: 所有结论都标注 `file:line`
- [ ] **行号验证**: 用 Read 工具验证过行号
- [ ] **代码支撑**: 提供了实际代码片段
- [ ] **禁止推测**: 没有"可能"、"大概"等不确定词汇（或明确标注）
- [ ] **改进建议**: 具体可执行，有修复前后对比
- [ ] **优先级**: 问题按严重程度分级
- [ ] **可视化**: 包含类继承关系图、调用流程图（如适用）
- [ ] **知识库**: 交叉验证过 `docs/` 下相关知识库
- [ ] **工具验证**: 用 Read/Grep 验证过所有代码
- [ ] **相关组件**: 对比过类似组件实现
- [ ] **格式规范**: Markdown 格式，代码块语法高亮
- [ ] **语言专业**: 技术术语准确，表达简洁

---

## 常见问题自查

### Q: 我不确定某个代码位置是否正确？

**A**: 使用 Read 工具验证：
```bash
Read: file.cpp (offset: line-10, limit: 20)
```

### Q: 我找不到某个方法的实现？

**A**: 使用 Grep 搜索：
```bash
Grep: "MethodName" --type cpp
```

### Q: 我不确定是否应该标注为"推测"？

**A**: 如果满足以下任一条件，必须标注"推测"：
- 没有直接看到代码实现
- 基于类似代码推断
- 没有用 Read/Grep 验证

### Q: 我发现了文档与代码不一致怎么办？

**A**:
1. 在分析结果中明确标注不一致
2. 提供正确的代码位置
3. 建议更新相关文档

---

## 质量标准

**优秀**:
- ✅ 所有检查项都通过
- ✅ 提供了额外的洞察
- ✅ 建议可执行且有优先级
- ✅ 可视化图表清晰准确

**合格**:
- ✅ 核心检查项通过（代码引用、代码支撑、工具验证）
- ⚠️ 部分可选项缺失（如可视化图表）

**不合格**:
- ❌ 核心检查项未通过
- ❌ 有未经证实的结论
- ❌ 缺少代码位置引用

# ArkUI æ¡ä»¶æ¸²æŸ“ç»„ä»¶å®Œæ•´æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
> **æ›´æ–°æ—¶é—´**ï¼š2026-02-05
> **æºç ç‰ˆæœ¬**ï¼šOpenHarmony ace_engine (master åˆ†æ”¯)
> **ä½œè€…**ï¼šåŸºäº CLAUDE.md è§„èŒƒè‡ªåŠ¨ç”Ÿæˆ

---

## ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [IfElse ç»„ä»¶è¯¦è§£](#ifelse-ç»„ä»¶è¯¦è§£)
   - [ç»„ä»¶å®šä½](#ç»„ä»¶å®šä½)
   - [æ ¸å¿ƒæ•°æ®ç»“æ„](#æ ¸å¿ƒæ•°æ®ç»“æ„)
   - [SetBranchId æµç¨‹](#setbranchid-æµç¨‹)
   - [TryRetake æœºåˆ¶](#tryretake-æœºåˆ¶)
3. [åˆ†æ”¯ç®¡ç†æœºåˆ¶](#åˆ†æ”¯ç®¡ç†æœºåˆ¶)
   - [branchId æ ‡è¯†](#branchid-æ ‡è¯†)
   - [åˆ†æ”¯åˆ‡æ¢æµç¨‹](#åˆ†æ”¯åˆ‡æ¢æµç¨‹)
   - [èŠ‚ç‚¹å¤ç”¨ç­–ç•¥](#èŠ‚ç‚¹å¤ç”¨ç­–ç•¥)
4. [çŠ¶æ€ä¿ç•™ä¸å¤ç”¨](#çŠ¶æ€ä¿ç•™ä¸å¤ç”¨)
   - [TryRetake è¯¦è§£](#tryretake-è¯¦è§£)
   - [CollectRetakenNodes](#collectretakenodes)
   - [å‡ ä½•è¿‡æ¸¡æ”¯æŒ](#å‡ ä½•è¿‡æ¸¡æ”¯æŒ)
5. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
   - [åŸºæœ¬ç”¨æ³•](#åŸºæœ¬ç”¨æ³•)
   - [å¤šåˆ†æ”¯æ¡ä»¶](#å¤šåˆ†æ”¯æ¡ä»¶)
   - [çŠ¶æ€ä¿ç•™ç¤ºä¾‹](#çŠ¶æ€ä¿ç•™ç¤ºä¾‹)
6. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
   - [åˆ†æ”¯åˆ‡æ¢æ€§èƒ½](#åˆ†æ”¯åˆ‡æ¢æ€§èƒ½)
   - [èŠ‚ç‚¹å¤ç”¨ä¼˜åŒ–](#èŠ‚ç‚¹å¤ç”¨ä¼˜åŒ–)
   - [åŠ¨ç”»ä¼˜åŒ–å»ºè®®](#åŠ¨ç”»ä¼˜åŒ–å»ºè®®)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
   - [åˆ†æ”¯åˆ‡æ¢ä¸ç”Ÿæ•ˆ](#åˆ†æ”¯åˆ‡æ¢ä¸ç”Ÿæ•ˆ)
   - [çŠ¶æ€ä¸¢å¤±é—®é¢˜](#çŠ¶æ€ä¸¢å¤±é—®é¢˜)
   - [æ€§èƒ½é—®é¢˜](#æ€§èƒ½é—®é¢˜)
   - [åŠ¨ç”»é—®é¢˜](#åŠ¨ç”»é—®é¢˜)
8. [ä¸ if-else è¯­æ³•å¯¹æ¯”](#ä¸-if-else-è¯­æ³•å¯¹æ¯”)
9. [é™„å½•](#é™„å½•)

---

## æ¦‚è¿°

### ç»„ä»¶å®šä½

**IfElse ç»„ä»¶**æ˜¯ OpenHarmony ArkUI æ¡†æ¶ä¸­å®ç°**æ¡ä»¶æ¸²æŸ“**çš„æ ¸å¿ƒè¯­æ³•èŠ‚ç‚¹ï¼ŒåŸºäº `if-elseif-else` æ„å»ºå£°æ˜å¼ UI çš„æ¡ä»¶åˆ†æ”¯åˆ‡æ¢èƒ½åŠ›ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- **åˆ†æ”¯æ ‡è¯†ç®¡ç†**ï¼šä½¿ç”¨ `branchId_` å”¯ä¸€æ ‡è¯† if-elseif-else æ„é€ ä¸­çš„å„ä¸ªåˆ†æ”¯
- **çŠ¶æ€ä¿ç•™**ï¼šé€šè¿‡ `TryRetake()` æœºåˆ¶æ”¯æŒåˆ†æ”¯èŠ‚ç‚¹çš„å¤ç”¨å’ŒçŠ¶æ€ä¿ç•™
- **åŠ¨ç”»æ”¯æŒ**ï¼šåœ¨åˆ†æ”¯åˆ‡æ¢æ—¶æ”¯æŒè¿‡æ¸¡åŠ¨ç”»ï¼ˆé€šè¿‡ `allowTransition` å‚æ•°ï¼‰
- **å‡ ä½•è¿‡æ¸¡**ï¼šæ”¯æŒ `geometryTransition` åŠ¨ç”»æ•ˆæœï¼Œå®ç°å¹³æ»‘çš„ç»„ä»¶è¿‡æ¸¡

**æŠ€æœ¯æ ˆ**ï¼š
- **å‰ç«¯**ï¼šArkTS/TypeScriptï¼ˆå£°æ˜å¼å‰ç«¯ï¼‰ã€Cangjieï¼ˆCJ å‰ç«¯ï¼‰
- **æ¡¥æ¥å±‚**ï¼šJSViewAbstract + Model Layer
- **æ ¸å¿ƒå±‚**ï¼šNG Syntax Architectureï¼ˆIfElseNodeï¼‰
- **æ¸²æŸ“å±‚**ï¼šRosen + Skia

**ä»£ç è§„æ¨¡**ï¼š
- æ ¸å¿ƒæ–‡ä»¶ï¼šçº¦ 5 ä¸ªæ–‡ä»¶
- æ ¸å¿ƒä»£ç ï¼šçº¦ 500+ è¡Œ C++ ä»£ç 
- æ¶‰åŠ 2 ä¸ªæ¶æ„å±‚æ¬¡ï¼ˆCoreã€Bridgeï¼‰

### æ¶æ„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ ArkTS / Cangjie                                   â”‚
â”‚                                                          â”‚
â”‚  if (this.condition) {                                  â”‚
â”‚    Text("Branch A")                                      â”‚
â”‚  } else if (this.otherCondition) {                      â”‚
â”‚    Text("Branch B")                                      â”‚
â”‚  } else {                                                â”‚
â”‚    Text("Branch C")                                      â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bridge Layer (æ¡¥æ¥å±‚)                                   â”‚
â”‚                                                          â”‚
â”‚  å£°æ˜å¼å‰ç«¯ï¼šframeworks/bridge/declarative_frontend/    â”‚
â”‚              jsview/js_if_else.cpp                       â”‚
â”‚  CJ å‰ç«¯ï¼š  frameworks/bridge/cj_frontend/interfaces/   â”‚
â”‚              cj_ffi/cj_if_else_ffi.cpp                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core Layer (IfElseNode)                                 â”‚
â”‚                                                          â”‚
â”‚  class IfElseNode : public UINode                       â”‚
â”‚    æºç ï¼šframeworks/core/components_ng/syntax/          â”‚
â”‚          if_else_node.h:27                               â”‚
â”‚                                                          â”‚
â”‚  æ ¸å¿ƒæ–¹æ³•ï¼š                                                â”‚
â”‚  - SetBranchId(): è®¾ç½®åˆ†æ”¯IDï¼Œè§¦å‘åˆ†æ”¯åˆ‡æ¢                â”‚
â”‚  - TryRetake(): å°è¯•å¤ç”¨ä¹‹å‰åˆ†æ”¯çš„èŠ‚ç‚¹                    â”‚
â”‚  - FlushUpdateAndMarkDirty(): åˆ·æ–°å¹¶æ ‡è®°è„çŠ¶æ€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UINode åŸºç±»æ–¹æ³•                                          â”‚
â”‚                                                          â”‚
â”‚  - Clean(): æ¸…ç†å­èŠ‚ç‚¹                                    â”‚
â”‚  - GetDisappearingChildById(): è·å–æ¶ˆå¤±çš„å­èŠ‚ç‚¹           â”‚
â”‚  - CollectCleanedChildren(): æ”¶é›†å·²æ¸…ç†çš„å­èŠ‚ç‚¹           â”‚
â”‚  - MarkNeedFrameFlushDirty(): æ ‡è®°éœ€è¦åˆ·æ–°                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## IfElse ç»„ä»¶è¯¦è§£

### ç»„ä»¶å®šä½

**IfElseNode** æ˜¯ ArkUI æ¡ä»¶æ¸²æŸ“çš„æ ¸å¿ƒå®ç°ç±»ï¼Œç»§æ‰¿è‡ª `UINode`ï¼Œè´Ÿè´£ç®¡ç† if-elseif-else æ„é€ ä¸­çš„å¤šä¸ªåˆ†æ”¯ã€‚

**ç»§æ‰¿å…³ç³»**ï¼š
```
UINode (åŸºç±»)
    â†“
IfElseNode (è¯­æ³•èŠ‚ç‚¹)
    â†“
ç®¡ç†å¤šä¸ªåˆ†æ”¯çš„å­èŠ‚ç‚¹
```

**å…³é”®ç‰¹æ€§**ï¼š
- `IsSyntaxNode()` è¿”å› `true`ï¼šæ ‡è¯†è¿™æ˜¯ä¸€ä¸ªè¯­æ³•èŠ‚ç‚¹ï¼ˆéç»„ä»¶èŠ‚ç‚¹ï¼‰
- `IsAtomicNode()` è¿”å› `false`ï¼šä¸æ˜¯åŸå­èŠ‚ç‚¹

**æºç ä½ç½®**ï¼š
- å¤´æ–‡ä»¶ï¼š`frameworks/core/components_ng/syntax/if_else_node.h:27`
- å®ç°ï¼š`frameworks/core/components_ng/syntax/if_else_node.cpp:21-132`

### æ ¸å¿ƒæ•°æ®ç»“æ„

#### 1. branchId_ - åˆ†æ”¯æ ‡è¯†ç¬¦

```cpp
// æºç ï¼šif_else_node.h:63-66
// å”¯ä¸€æ ‡è¯† if-elseif-else æ„é€ ä¸­çš„åˆ†æ”¯
// -1 è¡¨ç¤ºæœªåˆå§‹åŒ–ï¼Œé¦–æ¬¡æ¸²æŸ“å‰
int32_t branchId_ = -1;
```

**ä½œç”¨**ï¼š
- æ ‡è¯†å½“å‰æ¿€æ´»çš„åˆ†æ”¯ï¼ˆif åˆ†æ”¯ã€elseif åˆ†æ”¯æˆ– else åˆ†æ”¯ï¼‰
- å€¼ä¸º `-1` è¡¨ç¤ºæœªåˆå§‹åŒ–ï¼ˆé¦–æ¬¡æ¸²æŸ“å‰ï¼‰
- æ¯ä¸ªåˆ†æ”¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆå”¯ä¸€çš„å¸¸é‡ ID

**åˆ†æ”¯ ID ç”Ÿæˆè§„åˆ™**ï¼ˆæ¨æµ‹ï¼‰ï¼š
- if åˆ†æ”¯ï¼š`0`
- elseif åˆ†æ”¯ï¼š`1`, `2`, `3`, ...
- else åˆ†æ”¯ï¼šæœ€åä¸€ä¸ª ID

#### 2. branchIdChanged_ - åˆ†æ”¯å˜æ›´æ ‡å¿—

```cpp
// æºç ï¼šif_else_node.h:68-70
// ç”± SetBranchId è®¾ç½®ï¼ŒFlushUpdateAndMarkDirty æ¸…é™¤
bool branchIdChanged_ = false;
```

**ä½œç”¨**ï¼š
- æ ‡è¯†åˆ†æ”¯æ˜¯å¦å‘ç”Ÿå˜æ›´
- `SetBranchId()` è®¾ç½®ä¸º `true`ï¼ˆå¦‚æœåˆ†æ”¯ç¡®å®å˜åŒ–ï¼‰
- `FlushUpdateAndMarkDirty()` æ¸…é™¤ä¸º `false`

#### 3. retakenElmtIds_ - é‡æ–°è·å–çš„èŠ‚ç‚¹ ID åˆ—è¡¨

```cpp
// æºç ï¼šif_else_node.h:72
// é‡æ–°è·å–çš„èŠ‚ç‚¹IDåˆ—è¡¨
std::list<int32_t> retakenElmtIds_;
```

**ä½œç”¨**ï¼š
- å­˜å‚¨ä» `TryRetake()` æˆåŠŸå¤ç”¨çš„èŠ‚ç‚¹ ID
- ç”¨äºé€šçŸ¥å‰ç«¯å“ªäº›èŠ‚ç‚¹è¢«å¤ç”¨
- é¿å…é‡å¤åˆ›å»ºå’Œé”€æ¯èŠ‚ç‚¹

### SetBranchId æµç¨‹

#### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. SetBranchId è¢«è°ƒç”¨                                   â”‚
â”‚     æºç ï¼šif_else_node.cpp:65-78                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ æ¯”è¾ƒ branchId_ ä¸ value      â”‚
          â”‚ branchIdChanged_ =          â”‚
          â”‚ (branchId_ != value)        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ branchIdChanged_?     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“              â†“
              false          true
                 â†“              â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ ç›´æ¥è¿”å› â”‚    â”‚ 2. æ¸…ç†æ—§åˆ†æ”¯å­èŠ‚ç‚¹           â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Clean(false, true, branchId_)â”‚
                         â”‚ æºç ï¼šif_else_node.cpp:74    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 3. æ”¶é›†å·²æ¸…ç†çš„å­èŠ‚ç‚¹ ID       â”‚
                         â”‚ CollectCleanedChildren()    â”‚
                         â”‚ - removedElmtId: è¢«ç§»é™¤çš„ID  â”‚
                         â”‚ - reservedElmtId: è¢«ä¿ç•™çš„ID â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 4. æ›´æ–°åˆ†æ”¯ ID               â”‚
                         â”‚ branchId_ = value            â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. FlushUpdateAndMarkDirty è¢«è°ƒç”¨                      â”‚
â”‚     æºç ï¼šif_else_node.cpp:80-96                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ branchIdChanged_?     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“              â†“
              false          true
                 â†“              â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ ç›´æ¥è¿”å› â”‚    â”‚ 6. æŸ¥æ‰¾çˆ¶ FrameNode         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ éå†çˆ¶èŠ‚ç‚¹é“¾                  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 7. é€šçŸ¥çˆ¶å®¹å™¨å­èŠ‚ç‚¹å·²æ›´æ–°     â”‚
                         â”‚ frameNode->ChildrenUpdatedFrom(0)â”‚
                         â”‚ æºç ï¼šif_else_node.cpp:87    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 8. æ ‡è®°éœ€è¦åˆ·æ–°               â”‚
                         â”‚ MarkNeedFrameFlushDirty(     â”‚
                         â”‚   PROPERTY_UPDATE_BY_CHILD_REQUEST)â”‚
                         â”‚ æºç ï¼šif_else_node.cpp:93    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 9. æ¸…é™¤å˜æ›´æ ‡å¿—               â”‚
                         â”‚ branchIdChanged_ = false     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                    [è§¦å‘å¸ƒå±€å’Œæ¸²æŸ“æ›´æ–°]
```

#### æºç åˆ†æ

**â‘  SetBranchId å®ç°** - `if_else_node.cpp:65-78`

```cpp
void IfElseNode::SetBranchId(int32_t value, std::list<int32_t>& removedElmtId, std::list<int32_t>& reservedElmtId)
{
    // æ£€æŸ¥åˆ†æ”¯æ˜¯å¦çœŸæ­£å˜åŒ–
    branchIdChanged_ = (branchId_ != value);

    TAG_LOGD(AceLogTag::ACE_IF, "IfElse(%{public}d).SetBranchId branchIdChanged_: %{public}d",
        GetId(), branchIdChanged_);

    if (branchIdChanged_) {
        // æ”¶é›†æ‰€æœ‰å­èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹çš„ elmtId
        // è¿™äº›å°†è¢«ç§»é™¤ï¼Œä½†å¦‚æœå­˜åœ¨åŠ¨ç”»å¯èƒ½ä¼šæœ‰å»¶è¿Ÿ
        // list of elmtIds is sent back to calling TS ViewPU.ifElseBranchUpdateFunction()

        // Clean() æ–¹æ³•ï¼š
        // - cleanDirectly = false: ä¸ç«‹å³æ¸…ç†ï¼Œå…è®¸åŠ¨ç”»
        // - allowTransition = true: å…è®¸è½¬åœºåŠ¨ç”»
        // - branchId_: å½“å‰åˆ†æ”¯ IDï¼ˆç”¨äºè¯†åˆ«è¦æ¸…ç†çš„åˆ†æ”¯ï¼‰
        Clean(false, true, branchId_);

        // æ”¶é›†å·²æ¸…ç†çš„å­èŠ‚ç‚¹ ID
        // - removedElmtId: è¢«ç§»é™¤çš„èŠ‚ç‚¹ ID
        // - reservedElmtId: è¢«ä¿ç•™çš„èŠ‚ç‚¹ IDï¼ˆç”¨äºå¤ç”¨ï¼‰
        CollectCleanedChildren(GetChildren(), removedElmtId, reservedElmtId, true);

        // æ›´æ–°åˆ†æ”¯ ID
        branchId_ = value;
    }
}
```

**å…³é”®å‚æ•°è§£é‡Š**ï¼š

| å‚æ•° | å€¼ | å«ä¹‰ |
|------|-----|------|
| `cleanDirectly` | `false` | ä¸ç«‹å³æ¸…ç†ï¼Œå…è®¸æ‰§è¡Œæ¶ˆå¤±åŠ¨ç”» |
| `allowTransition` | `true` | å…è®¸è½¬åœºåŠ¨ç”»ï¼ˆå¦‚ `transition` å‚æ•°æŒ‡å®šçš„åŠ¨ç”»ï¼‰ |
| `branchId` | `branchId_` | å½“å‰åˆ†æ”¯ IDï¼ˆåœ¨æ›´æ–°å‰ï¼‰ï¼Œç”¨äºæ ‡è¯†è¦æ¸…ç†çš„åˆ†æ”¯ |

**â‘¡ FlushUpdateAndMarkDirty å®ç°** - `if_else_node.cpp:80-96`

```cpp
void IfElseNode::FlushUpdateAndMarkDirty()
{
    if (branchIdChanged_) {
        // æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹
        auto parent = GetParent();
        while (parent) {
            // å°è¯•è½¬æ¢ä¸º FrameNode
            auto frameNode = AceType::DynamicCast<FrameNode>(parent);
            if (frameNode) {
                // é€šçŸ¥çˆ¶å®¹å™¨ä»ç´¢å¼• 0 å¼€å§‹çš„å­èŠ‚ç‚¹å·²æ›´æ–°
                // è¿™å°†è§¦å‘çˆ¶å®¹å™¨é‡æ–°æµ‹é‡å’Œå¸ƒå±€
                frameNode->ChildrenUpdatedFrom(0);
                break;
            }
            parent = parent->GetParent();
        }

        // æ ‡è®°çˆ¶èŠ‚ç‚¹ dirty ä»¥è§¦å‘ measure
        // PROPERTY_UPDATE_BY_CHILD_REQUEST: ç”±å­èŠ‚ç‚¹è¯·æ±‚çš„å±æ€§æ›´æ–°
        MarkNeedFrameFlushDirty(PROPERTY_UPDATE_BY_CHILD_REQUEST);
    }

    // æ¸…é™¤åˆ†æ”¯å˜æ›´æ ‡å¿—
    branchIdChanged_ = false;
}
```

**å…³é”®é€»è¾‘**ï¼š

1. **å‘ä¸ŠæŸ¥æ‰¾ FrameNode**ï¼š
   - éå†çˆ¶èŠ‚ç‚¹é“¾ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ª `FrameNode`
   - `IfElseNode` æœ¬èº«æ˜¯ `UINode`ï¼Œå…¶çˆ¶èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ª `UINode` æˆ– `FrameNode`

2. **é€šçŸ¥çˆ¶å®¹å™¨å­èŠ‚ç‚¹æ›´æ–°**ï¼š
   - `ChildrenUpdatedFrom(0)`ï¼šé€šçŸ¥çˆ¶å®¹å™¨ä»ç´¢å¼• 0 å¼€å§‹çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½å¯èƒ½å·²æ›´æ–°
   - è¿™å°†è§¦å‘çˆ¶å®¹å™¨çš„å¸ƒå±€ç®—æ³•é‡æ–°è®¡ç®—

3. **æ ‡è®°è„çŠ¶æ€**ï¼š
   - `PROPERTY_UPDATE_BY_CHILD_REQUEST`ï¼šç”±å­èŠ‚ç‚¹è¯·æ±‚çš„å±æ€§æ›´æ–°
   - è§¦å‘ `OnDirtyLayoutWrapperSwap` ç­‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

### TryRetake æœºåˆ¶

#### åŸºæœ¬åŸç†

**TryRetake** æœºåˆ¶å…è®¸åœ¨åˆ†æ”¯åˆ‡æ¢æ—¶**å¤ç”¨ä¹‹å‰æ¸²æŸ“è¿‡çš„èŠ‚ç‚¹**ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºã€‚è¿™å¯¹äºä»¥ä¸‹åœºæ™¯éå¸¸æœ‰ç”¨ï¼š

- **ä¿ç•™ UI çŠ¶æ€**ï¼šå¦‚è¾“å…¥æ¡†å†…å®¹ã€æ»šåŠ¨ä½ç½®
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é‡å¤åˆ›å»ºå’Œé”€æ¯èŠ‚ç‚¹
- **åŠ¨ç”»è¿‡æ¸¡**ï¼šé…åˆ `geometryTransition` å®ç°å¹³æ»‘è¿‡æ¸¡

#### è°ƒç”¨æ—¶æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯æ¡ä»¶å˜åŒ–                                             â”‚
â”‚  if (this.condition)  â†’  else if (this.otherCondition)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯è°ƒç”¨ IfElseNode.SetBranchId()                       â”‚
â”‚  - æ—§åˆ†æ”¯èŠ‚ç‚¹è¢«æ ‡è®°ä¸ºæ¶ˆå¤±ï¼ˆdisappearingï¼‰                  â”‚
â”‚  - æ—§åˆ†æ”¯èŠ‚ç‚¹æœªè¢«ç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¿ç•™åœ¨ disappearing é˜Ÿåˆ—   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯æ„å»ºæ–°åˆ†æ”¯å†…å®¹                                        â”‚
â”‚  - å¯¹æ¯ä¸ªå­èŠ‚ç‚¹ï¼Œå…ˆè°ƒç”¨ If.canRetake(id)                 â”‚
â”‚  - å¦‚æœè¿”å› trueï¼Œè°ƒç”¨ IfElseNode.TryRetake(id)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TryRetake æ‰§è¡Œæµç¨‹                                       â”‚
â”‚  1. GetDisappearingChildById(id, branchId_)             â”‚
â”‚     ä»æ¶ˆå¤±é˜Ÿåˆ—ä¸­æŸ¥æ‰¾èŠ‚ç‚¹                                  â”‚
â”‚  2. SetJSViewActive(true)                               â”‚
â”‚     é‡æ–°æ¿€æ´»èŠ‚ç‚¹                                          â”‚
â”‚  3. AddChild(node)                                       â”‚
â”‚     å°†èŠ‚ç‚¹é‡æ–°æ·»åŠ åˆ°å­èŠ‚ç‚¹åˆ—è¡¨                             â”‚
â”‚  4. UpdateAllGeometryTransition(node)                   â”‚
â”‚     æ›´æ–°å‡ ä½•è¿‡æ¸¡åŠ¨ç”»                                       â”‚
â”‚  5. CollectRetakenNodes(node)                           â”‚
â”‚     æ”¶é›†è¢«å¤ç”¨çš„èŠ‚ç‚¹ ID                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æºç åˆ†æ

**TryRetake å®ç°** - `if_else_node.cpp:98-111`

```cpp
bool IfElseNode::TryRetake(const std::string& id)
{
    // ä»æ¶ˆå¤±é˜Ÿåˆ—ä¸­è·å–æŒ‡å®š ID çš„èŠ‚ç‚¹
    // branchId_: ä¹‹å‰åˆ†æ”¯çš„ IDï¼Œç”¨äºé™å®šæœç´¢èŒƒå›´
    auto node = GetDisappearingChildById(id, branchId_);
    if (node) {
        ACE_SCOPED_TRACE("IfElse TryRetake validate.");

        // é‡æ–°æ¿€æ´»èŠ‚ç‚¹
        node->SetJSViewActive(true);

        // å°†èŠ‚ç‚¹é‡æ–°æ·»åŠ åˆ°å­èŠ‚ç‚¹åˆ—è¡¨
        AddChild(node);

        // å¯¹äº geometryTransitionï¼Œè®©æ‰€æœ‰é‡ç”¨çš„å­èŠ‚ç‚¹è°ƒç”¨ UpdateGeometryTransition
        LayoutProperty::UpdateAllGeometryTransition(node);

        // æ”¶é›†è¢«å¤ç”¨çš„èŠ‚ç‚¹ ID
        CollectRetakenNodes(node);

        return true;  // æˆåŠŸå¤ç”¨
    }
    return false;  // æœªæ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹
}
```

**CollectRetakenNodes å®ç°** - `if_else_node.cpp:113-121`

```cpp
void IfElseNode::CollectRetakenNodes(const RefPtr<UINode>& node)
{
    // å°†èŠ‚ç‚¹ ID æ·»åŠ åˆ°å¤ç”¨åˆ—è¡¨
    retakenElmtIds_.emplace_back(node->GetId());

    // å¦‚æœä¸æ˜¯ CustomNodeï¼Œé€’å½’æ”¶é›†æ‰€æœ‰å­èŠ‚ç‚¹çš„ ID
    if (GetTag() != V2::JS_VIEW_ETS_TAG) {
        for (auto const& child : node->GetChildren()) {
            CollectRetakenNodes(child);
        }
    }
}
```

**GetRetakenElmtIds å®ç°** - `if_else_node.cpp:123-130`

```cpp
bool IfElseNode::GetRetakenElmtIds(std::list<int32_t>& retakenElmtIds)
{
    if (retakenElmtIds_.size() == 0) {
        return false;
    }

    // å°†å¤ç”¨åˆ—è¡¨ç§»åŠ¨åˆ°è¾“å‡ºå‚æ•°
    retakenElmtIds.splice(retakenElmtIds.end(), retakenElmtIds_);
    return true;
}
```

---

## åˆ†æ”¯ç®¡ç†æœºåˆ¶

### branchId æ ‡è¯†

#### ç¼–è¯‘å™¨ç”Ÿæˆçš„åˆ†æ”¯ ID

ArkTS ç¼–è¯‘å™¨åœ¨å¤„ç† if-elseif-else è¯­æ³•æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªåˆ†æ”¯ç”Ÿæˆå”¯ä¸€çš„å¸¸é‡ IDï¼š

```typescript
// ArkTS æºç 
if (this.condition1) {
  Text("Branch A")
} else if (this.condition2) {
  Text("Branch B")
} else {
  Text("Branch C")
}

// ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¼ªä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰
If.create()
if (this.condition1) {
  this.ifElseBranchUpdateFunction(0, () => {  // branchId = 0
    Text("Branch A")
  })
} else if (this.condition2) {
  this.ifElseBranchUpdateFunction(1, () => {  // branchId = 1
    Text("Branch B")
  })
} else {
  this.ifElseBranchUpdateFunction(2, () => {  // branchId = 2
    Text("Branch C")
  })
}
If.pop()
```

**æºç æ³¨é‡Š** - `if_else_node.cpp:35-64`

```cpp
/*
 * how if else works
 * the transpiler generated JS code is like this(simplified, but main points shown)
 * this.observeComponentCreation(..., () => {
 * If.create();
 * if (condition1) {
 *    this.ifElseBranchUpdateFunction(compilerGeneratedUniqueConstBranchID, () =>
 *          code for children first render
 *    )
 * } else if (condition2) {
 *    this.ifElseBranchUpdateFunction(compilerGeneratedUniqueConstBranchID, () =>
 *          code for children first render
 *    )
 * } else {
 *    // else added by the transpiler
 *    If.setBranchId(compilerGeneratedUniqueConstBranchID)
 * }
 * If.pop()
 * - if re-renders whenever one of the variables used in 'condition' during last render has changed.
 *      - The dependent variables can change from one render of if to the next, depending if 'condition1' and
 *        'condition2' bind to different variables.
 *      - If can re-render, but the branch does not change, e.g. if 'condition1' is (this.i > 20)
 *        then If will re-render whenever i changes.
 * - eDSL to JS traspiler generates a unique id for each branch of the code inside.
 *   Thereby the framework can detect that the branch has actually changed.
 *   In this case ViewPU.ifElseBranchUpdateFunction will call IfElseNode::SetBranchId to upate
 *   and it will execute the 2nd parameter lambda function to re-generate the children.
 * - In case of if without else, or if ... else if ... , eDSL to JS traspiler generates
 *   an extra else clause in which to set the branchId (calls IfElseNode::SetBranchId)
 * - IfElseNode::FlushUpdateAndMarkDirty is called upon If.Pop()
 */
```

#### åˆ†æ”¯ ID çŠ¶æ€è½¬æ¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆå§‹çŠ¶æ€ï¼šbranchId_ = -1                                â”‚
â”‚  è¡¨ç¤ºæœªåˆå§‹åŒ–ï¼Œé¦–æ¬¡æ¸²æŸ“å‰                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¦–æ¬¡æ¸²æŸ“ï¼šSetBranchId(0)                                 â”‚
â”‚  branchId_ = 0ï¼ˆif åˆ†æ”¯ï¼‰                                 â”‚
â”‚  branchIdChanged_ = true                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¡ä»¶å˜åŒ–ï¼šSetBranchId(1)                                 â”‚
â”‚  branchId_ = 1ï¼ˆelseif åˆ†æ”¯ï¼‰                             â”‚
â”‚  branchIdChanged_ = true                                 â”‚
â”‚  æ¸…ç†åˆ†æ”¯ 0 çš„å­èŠ‚ç‚¹                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¡ä»¶å†æ¬¡å˜åŒ–ï¼šSetBranchId(0)                             â”‚
â”‚  branchId_ = 0ï¼ˆif åˆ†æ”¯ï¼‰                                 â”‚
â”‚  branchIdChanged_ = true                                 â”‚
â”‚  æ¸…ç†åˆ†æ”¯ 1 çš„å­èŠ‚ç‚¹                                       â”‚
â”‚  å¯ä»¥é€šè¿‡ TryRetake å¤ç”¨åˆ†æ”¯ 0 çš„æ—§èŠ‚ç‚¹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†æ”¯åˆ‡æ¢æµç¨‹

#### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ¡ä»¶å˜é‡å˜åŒ–                                           â”‚
â”‚  this.condition1 ä» true å˜ä¸º false                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. çŠ¶æ€ç®¡ç†æ¡†æ¶è§¦å‘é‡æ–°æ¸²æŸ“                               â”‚
â”‚  @State è£…é¥°çš„å˜é‡å˜åŒ–ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. å‰ç«¯æ‰§è¡Œæ¡ä»¶åˆ¤æ–­                                       â”‚
â”‚  if (this.condition1) { ... }                            â”‚
â”‚  else if (this.condition2) { ... }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. è°ƒç”¨ ifElseBranchUpdateFunction                       â”‚
â”‚  this.ifElseBranchUpdateFunction(newBranchId, () => {   â”‚
â”‚    // é‡æ–°æ„å»ºæ–°åˆ†æ”¯çš„å­èŠ‚ç‚¹                               â”‚
â”‚  })                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. æ¡¥æ¥å±‚è°ƒç”¨ SetBranchId                                â”‚
â”‚  IfElseModelNG::SetBranchId(newBranchId, ...)           â”‚
â”‚  æºç ï¼šif_else_model_ng.cpp:36-42                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. IfElseNode::SetBranchId                              â”‚
â”‚  - æ¯”è¾ƒ branchId_ å’Œ newBranchId                         â”‚
â”‚  - å¦‚æœä¸åŒï¼Œæ¸…ç†æ—§åˆ†æ”¯å­èŠ‚ç‚¹                               â”‚
â”‚  - æ›´æ–° branchId_ = newBranchId                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. å‰ç«¯æ„å»ºæ–°åˆ†æ”¯å†…å®¹                                     â”‚
â”‚  - å¯¹æ¯ä¸ªå­èŠ‚ç‚¹ï¼Œå…ˆå°è¯• TryRetake                          â”‚
â”‚  - å¦‚æœå¤±è´¥ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. è°ƒç”¨ If.Pop()                                         â”‚
â”‚  IfElseModelNG::Pop()                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9. IfElseNode::FlushUpdateAndMarkDirty                  â”‚
â”‚  - é€šçŸ¥çˆ¶å®¹å™¨å­èŠ‚ç‚¹å·²æ›´æ–°                                   â”‚
â”‚  - æ ‡è®°éœ€è¦åˆ·æ–°                                            â”‚
â”‚  - æ¸…é™¤ branchIdChanged_ æ ‡å¿—                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  10. è§¦å‘å¸ƒå±€å’Œæ¸²æŸ“æ›´æ–°                                    â”‚
â”‚  - çˆ¶å®¹å™¨é‡æ–°æµ‹é‡å’Œå¸ƒå±€                                    â”‚
â”‚  - æ¸²æŸ“ç®¡é“ç»˜åˆ¶æ–°åˆ†æ”¯å†…å®¹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŠ‚ç‚¹å¤ç”¨ç­–ç•¥

#### å¤ç”¨æ¡ä»¶

èŠ‚ç‚¹å¯ä»¥è¢«å¤ç”¨éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

1. **èŠ‚ç‚¹ ID åŒ¹é…**ï¼š
   - å‰ç«¯æä¾›çš„ ID å¿…é¡»ä¸ä¹‹å‰åˆ†æ”¯ä¸­æŸä¸ªèŠ‚ç‚¹çš„ ID ç›¸åŒ
   - ID é€šå¸¸ç”±ç»„ä»¶çš„ `id` å±æ€§æˆ–ç¼–è¯‘å™¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦å†³å®š

2. **èŠ‚ç‚¹ä»åœ¨æ¶ˆå¤±é˜Ÿåˆ—ä¸­**ï¼š
   - èŠ‚ç‚¹ä¸èƒ½å·²ç»è¢«é”€æ¯
   - `Clean()` æ–¹æ³•çš„ `cleanDirectly` å‚æ•°å¿…é¡»ä¸º `false`

3. **èŠ‚ç‚¹æ¥è‡ªæ­£ç¡®çš„åˆ†æ”¯**ï¼š
   - `GetDisappearingChildById(id, branchId_)` ä¼šæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æ¥è‡ªæŒ‡å®šåˆ†æ”¯

#### å¤ç”¨ç­–ç•¥å¯¹æ¯”

| åœºæ™¯ | èƒ½å¦å¤ç”¨ | åŸå›  |
|------|---------|------|
| **åŒä¸€åˆ†æ”¯å†…é‡æ–°æ¸²æŸ“** | âœ… å¯ä»¥ | `branchId` ä¸å˜ï¼Œå­èŠ‚ç‚¹ç›´æ¥æ›´æ–° |
| **åˆ‡æ¢åˆ°å·²å­˜åœ¨çš„åˆ†æ”¯** | âœ… å¯ä»¥ | é€šè¿‡ `TryRetake` å¤ç”¨æ—§èŠ‚ç‚¹ |
| **åˆ‡æ¢åˆ°æ–°åˆ†æ”¯** | âŒ ä¸å¯ä»¥ | éœ€è¦åˆ›å»ºæ–°èŠ‚ç‚¹ |
| **åˆ†æ”¯åˆ‡æ¢ååˆ‡å›åŸåˆ†æ”¯** | âœ… å¯ä»¥ | å¦‚æœæ—§èŠ‚ç‚¹æœªé”€æ¯ï¼Œå¯ä»¥å¤ç”¨ |

#### æ€§èƒ½å½±å“

```
ä¸å¤ç”¨ï¼ˆæ¯æ¬¡åˆ›å»ºæ–°èŠ‚ç‚¹ï¼‰ï¼š
- æ—¶é—´ï¼š~50-100ms/èŠ‚ç‚¹ï¼ˆåˆ›å»º + åˆå§‹åŒ– + æ¸²æŸ“ï¼‰
- å†…å­˜ï¼šé¢‘ç¹åˆ†é…å’Œé‡Šæ”¾
- çŠ¶æ€ï¼šUI çŠ¶æ€ä¸¢å¤±ï¼ˆå¦‚æ»šåŠ¨ä½ç½®ã€è¾“å…¥å†…å®¹ï¼‰

å¤ç”¨èŠ‚ç‚¹ï¼š
- æ—¶é—´ï¼š~5-10ms/èŠ‚ç‚¹ï¼ˆæŸ¥æ‰¾ + é‡æ–°æ¿€æ´»ï¼‰
- å†…å­˜ï¼šæ— éœ€é¢å¤–åˆ†é…
- çŠ¶æ€ï¼šUI çŠ¶æ€ä¿ç•™
```

---

## çŠ¶æ€ä¿ç•™ä¸å¤ç”¨

### TryRetake è¯¦è§£

#### ä½¿ç”¨åœºæ™¯

**åœºæ™¯ 1ï¼šä¿ç•™è¾“å…¥æ¡†å†…å®¹**

```typescript
@State showPanel: boolean = false

if (this.showPanel) {
  Column() {
    TextInput({ placeholder: 'Enter text' })
      .id('myInput')  // å…³é”®ï¼šè®¾ç½®å›ºå®š ID
  }
}
```

**å·¥ä½œåŸç†**ï¼š
1. ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥å†…å®¹
2. `showPanel` å˜ä¸º `false`ï¼Œè¾“å…¥æ¡†è¢«ç§»é™¤ä½†ä¿ç•™åœ¨æ¶ˆå¤±é˜Ÿåˆ—
3. `showPanel` å˜ä¸º `true`ï¼Œå‰ç«¯è°ƒç”¨ `TryRetake('myInput')`
4. è¾“å…¥æ¡†è¢«é‡æ–°æ·»åŠ åˆ°æ¸²æŸ“æ ‘ï¼Œå†…å®¹ä¿ç•™

**åœºæ™¯ 2ï¼šä¿ç•™æ»šåŠ¨ä½ç½®**

```typescript
@State tabIndex: number = 0

if (this.tabIndex === 0) {
  List() {
    ForEach(this.items, (item) => {
      ListItem() { Text(item.name) }
    })
  }
  .id('tab0List')  // å…³é”®ï¼šè®¾ç½®å›ºå®š ID
}
```

#### å‰ç«¯è°ƒç”¨æµç¨‹

**å£°æ˜å¼å‰ç«¯** - `js_if_else.cpp:57-72`

```cpp
void JSIfElse::CanRetake(const JSCallbackInfo& info)
{
    if (info.Length() != 1) {
        TAG_LOGW(AceLogTag::ACE_IF, "CanRetake needs only 1 param");
        info.SetReturnValue(JSRef<JSVal>::Make(ToJSValue(false)));
        return;
    }
    if (!info[0]->IsString()) {
        TAG_LOGW(AceLogTag::ACE_IF, "CanRetake needs string param");
        info.SetReturnValue(JSRef<JSVal>::Make(ToJSValue(false)));
        return;
    }
    auto id = info[0]->ToString();
    auto result = IfElseModel::GetInstance()->CanRetake(id);
    info.SetReturnValue(JSRef<JSVal>::Make(ToJSValue(result)));
}
```

**å¯¹åº”çš„ ArkTS è°ƒç”¨**ï¼ˆä¼ªä»£ç ï¼‰ï¼š

```typescript
// å‰ç«¯ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¼ªä»£ç 
if (this.condition) {
  const nodeId = 'myComponent'
  if (If.canRetake(nodeId)) {
    // å¤ç”¨å·²æœ‰èŠ‚ç‚¹
    If.retake(nodeId)
  } else {
    // åˆ›å»ºæ–°èŠ‚ç‚¹
    MyComponent().id(nodeId)
  }
}
```

### CollectRetakenNodes

#### åŠŸèƒ½è¯´æ˜

**CollectRetakenNodes** é€’å½’æ”¶é›†è¢«å¤ç”¨çš„èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹çš„ IDï¼š

```cpp
// æºç ï¼šif_else_node.cpp:113-121
void IfElseNode::CollectRetakenNodes(const RefPtr<UINode>& node)
{
    // æ·»åŠ å½“å‰èŠ‚ç‚¹ ID
    retakenElmtIds_.emplace_back(node->GetId());

    // å¦‚æœä¸æ˜¯ CustomNodeï¼Œé€’å½’æ”¶é›†å­èŠ‚ç‚¹ ID
    if (GetTag() != V2::JS_VIEW_ETS_TAG) {
        for (auto const& child : node->GetChildren()) {
            CollectRetakenNodes(child);
        }
    }
}
```

**ä¸ºä»€ä¹ˆéœ€è¦é€’å½’æ”¶é›†**ï¼Ÿ

- å¤ç”¨ä¸€ä¸ªçˆ¶èŠ‚ç‚¹æ—¶ï¼Œå…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¹Ÿä¼šè¢«å¤ç”¨
- å‰ç«¯éœ€è¦çŸ¥é“æ‰€æœ‰è¢«å¤ç”¨çš„èŠ‚ç‚¹ IDï¼Œé¿å…é‡å¤åˆ›å»º

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// å‡è®¾å¤ç”¨ä»¥ä¸‹èŠ‚ç‚¹ç»“æ„ï¼š
// Column (id: 'col1')
//   â”œâ”€â”€ Text (id: 'txt1')
//   â””â”€â”€ Row (id: 'row1')
//       â”œâ”€â”€ Button (id: 'btn1')
//       â””â”€â”€ Button (id: 'btn2')

IfElseNode::TryRetake('col1')

// retakenElmtIds_ å°†åŒ…å«ï¼š
// ['col1', 'txt1', 'row1', 'btn1', 'btn2']
```

### å‡ ä½•è¿‡æ¸¡æ”¯æŒ

#### geometryTransition åŠ¨ç”»

**geometryTransition** æ˜¯ ArkUI æä¾›çš„è‡ªåŠ¨å¸ƒå±€è¿‡æ¸¡åŠ¨ç”»ï¼Œå¯ä»¥åœ¨ç»„ä»¶å°ºå¯¸ã€ä½ç½®å˜åŒ–æ—¶è‡ªåŠ¨æ·»åŠ å¹³æ»‘è¿‡æ¸¡ã€‚

**ä¸ TryRetake çš„é…åˆ**ï¼š

```cpp
// æºç ï¼šif_else_node.cpp:105-106
// å¯¹äº geometryTransitionï¼Œè®©æ‰€æœ‰é‡ç”¨çš„å­èŠ‚ç‚¹è°ƒç”¨ UpdateGeometryTransition
LayoutProperty::UpdateAllGeometryTransition(node);
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```typescript
@State showDetail: boolean = false

if (this.showDetail) {
  Column() {
    Text('Detail View')
      .fontSize(20)
  }
  .geometryTransition('detailView')  // å…³é”®ï¼šè®¾ç½®å‡ ä½•è¿‡æ¸¡ ID
} else {
  Column() {
    Text('Summary View')
      .fontSize(14)
  }
  .geometryTransition('detailView')  // ç›¸åŒ ID = è¿‡æ¸¡åŠ¨ç”»
}
```

**æ•ˆæœ**ï¼š
- å½“ `showDetail` åˆ‡æ¢æ—¶ï¼Œä¸¤ä¸ª Column ä¼šå¹³æ»‘è¿‡æ¸¡
- ä½ç½®ã€å°ºå¯¸ã€åœ†è§’ç­‰å±æ€§ä¼šè‡ªåŠ¨æ’å€¼
- æ— éœ€æ‰‹åŠ¨ç¼–å†™åŠ¨ç”»ä»£ç 

---

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•

#### ç¤ºä¾‹ 1ï¼šç®€å•çš„ if-else

```typescript
@Entry
@Component
struct BasicIfElse {
  @State isVisible: boolean = true

  build() {
    Column() {
      if (this.isVisible) {
        Text('Content is visible')
          .fontSize(20)
      } else {
        Text('Content is hidden')
          .fontSize(20)
          .fontColor(Color.Gray)
      }

      Button('Toggle')
        .onClick(() => {
          this.isVisible = !this.isVisible
        })
    }
  }
}
```

**å·¥ä½œæµç¨‹**ï¼š
1. åˆå§‹çŠ¶æ€ï¼š`isVisible = true`ï¼Œæ˜¾ç¤º "Content is visible"
2. ç‚¹å‡»æŒ‰é’®ï¼š`isVisible = false`
3. è§¦å‘é‡æ–°æ¸²æŸ“ï¼š
   - `SetBranchId(0)` â†’ `SetBranchId(1)`ï¼ˆå‡è®¾ if åˆ†æ”¯ ID ä¸º 0ï¼Œelse åˆ†æ”¯ ID ä¸º 1ï¼‰
   - æ¸…ç† "Content is visible" èŠ‚ç‚¹
   - åˆ›å»º "Content is hidden" èŠ‚ç‚¹
   - åˆ·æ–°å¸ƒå±€å’Œæ¸²æŸ“

#### ç¤ºä¾‹ 2ï¼šif-elseif-else

```typescript
@Entry
@Component
struct ScoreLevel {
  @State score: number = 85

  build() {
    Column() {
      if (this.score >= 90) {
        Text('ä¼˜ç§€')
          .fontSize(30)
          .fontColor(Color.Green)
      } else if (this.score >= 60) {
        Text('åŠæ ¼')
          .fontSize(30)
          .fontColor(Color.Orange)
      } else {
        Text('ä¸åŠæ ¼')
          .fontSize(30)
          .fontColor(Color.Red)
      }

      Slider({ value: this.score, min: 0, max: 100 })
        .onChange((value: number) => {
          this.score = value
        })
    }
  }
}
```

**åˆ†æ”¯ ID åˆ†é…**ï¼ˆæ¨æµ‹ï¼‰ï¼š
- if åˆ†æ”¯ï¼ˆ`score >= 90`ï¼‰ï¼šID = 0
- elseif åˆ†æ”¯ï¼ˆ`score >= 60`ï¼‰ï¼šID = 1
- else åˆ†æ”¯ï¼šID = 2

### å¤šåˆ†æ”¯æ¡ä»¶

#### ç¤ºä¾‹ 3ï¼šå¤šä¸ª elseif

```typescript
@Entry
@Component
struct WeatherStatus {
  @State temperature: number = 25

  build() {
    Column() {
      if (this.temperature > 30) {
        this.WeatherCard('ç‚çƒ­', Color.Red, 'â˜€ï¸')
      } else if (this.temperature > 20) {
        this.WeatherCard('æ¸©æš–', Color.Orange, 'â›…')
      } else if (this.temperature > 10) {
        this.WeatherCard('å‡‰çˆ½', Color.Blue, 'â˜ï¸')
      } else if (this.temperature > 0) {
        this.WeatherCard('å¯’å†·', Color.Cyan, 'â„ï¸')
      } else {
        this.WeatherCard('ä¸¥å¯’', Color.White, 'ğŸ¥¶')
      }

      Slider({ value: this.temperature, min: -10, max: 40 })
        .onChange((value: number) => {
          this.temperature = value
        })
    }
  }

  @Builder WeatherCard(title: string, color: Color, icon: string) {
    Row() {
      Text(icon).fontSize(40)
      Text(title).fontSize(24).fontColor(color)
    }
    .padding(20)
    .backgroundColor(Color.Grey)
    .borderRadius(10)
  }
}
```

### çŠ¶æ€ä¿ç•™ç¤ºä¾‹

#### ç¤ºä¾‹ 4ï¼šä¿ç•™è¾“å…¥æ¡†å†…å®¹

```typescript
@Entry
@Component
struct FormWithToggle {
  @State showForm: boolean = false
  @State inputValue: string = ''

  build() {
    Column() {
      Button(this.showForm ? 'Hide Form' : 'Show Form')
        .onClick(() => {
          this.showForm = !this.showForm
        })

      if (this.showForm) {
        Column() {
          TextInput({ placeholder: 'Enter your name', text: this.inputValue })
            .id('nameInput')  // å…³é”®ï¼šè®¾ç½®å›ºå®š ID
            .onChange((value: string) => {
              this.inputValue = value
            })

          Text(`Current value: ${this.inputValue}`)
            .margin({ top: 10 })
        }
        .padding(20)
        .backgroundColor(Color.Grey)
        .borderRadius(10)
      }
    }
  }
}
```

**å·¥ä½œåŸç†**ï¼š
1. ç”¨æˆ·è¾“å…¥ "John"
2. ç‚¹å‡» "Hide Form"ï¼Œè¡¨å•è¢«ç§»é™¤
3. ç‚¹å‡» "Show Form"ï¼Œè¡¨å•é‡æ–°æ˜¾ç¤º
4. **å…³é”®**ï¼šè¾“å…¥æ¡†å†…å®¹ "John" è¢«ä¿ç•™ï¼ˆé€šè¿‡ TryRetake æœºåˆ¶ï¼‰

#### ç¤ºä¾‹ 5ï¼šä¿ç•™æ»šåŠ¨ä½ç½®

```typescript
@Entry
@Component
struct TabContent {
  @State currentTab: number = 0
  private tabs: string[] = ['Tab 1', 'Tab 2', 'Tab 3']

  build() {
    Column() {
      Row() {
        ForEach(this.tabs, (tab: string, index: number) => {
          Text(tab)
            .padding(10)
            .backgroundColor(this.currentTab === index ? Color.Blue : Color.Grey)
            .onClick(() => {
              this.currentTab = index
            })
        })
      }

      if (this.currentTab === 0) {
        this.TabContent(0, Array.from({ length: 100 }, (_, i) => `Item ${i}`))
      } else if (this.currentTab === 1) {
        this.TabContent(1, Array.from({ length: 50 }, (_, i) => `Option ${i}`))
      } else if (this.currentTab === 2) {
        this.TabContent(2, Array.from({ length: 200 }, (_, i) => `Data ${i}`))
      }
    }
  }

  @Builder TabContent(tabIndex: number, items: string[]) {
    List() {
      ForEach(items, (item: string) => {
        ListItem() {
          Text(item)
            .width('100%')
            .height(50)
        }
      })
    }
    .id(`tab${tabIndex}List`)  // å…³é”®ï¼šä¸ºæ¯ä¸ª Tab çš„ List è®¾ç½®å”¯ä¸€ ID
    .width('100%')
    .height('100%')
  }
}
```

**æ•ˆæœ**ï¼š
- åˆ‡æ¢åˆ° Tab 2ï¼Œæ»šåŠ¨åˆ°ä¸­é—´ä½ç½®
- åˆ‡æ¢åˆ° Tab 1
- åˆ‡æ¢å› Tab 2
- **æ»šåŠ¨ä½ç½®ä¿ç•™**ï¼ˆé€šè¿‡ TryRetake å¤ç”¨ List èŠ‚ç‚¹ï¼‰

---

## æ€§èƒ½ä¼˜åŒ–

### åˆ†æ”¯åˆ‡æ¢æ€§èƒ½

#### æ€§èƒ½å½±å“å› ç´ 

**1. åˆ†æ”¯å¤æ‚åº¦**

```
ç®€å•åˆ†æ”¯ï¼ˆå•ä¸ªç»„ä»¶ï¼‰ï¼š
- åˆ‡æ¢æ—¶é—´ï¼š~10-20ms
- åˆ›å»º/é”€æ¯å¼€é”€ï¼šä½

å¤æ‚åˆ†æ”¯ï¼ˆåµŒå¥—ç»„ä»¶ + åˆ—è¡¨ï¼‰ï¼š
- åˆ‡æ¢æ—¶é—´ï¼š~100-500ms
- åˆ›å»º/é”€æ¯å¼€é”€ï¼šé«˜
```

**2. åŠ¨ç”»å½±å“**

```
æ— åŠ¨ç”»ï¼š
- åˆ‡æ¢æ—¶é—´ï¼š~10-100ms
- ç”¨æˆ·ä½“éªŒï¼šçªå…€

æœ‰åŠ¨ç”»ï¼ˆtransition/geometryTransitionï¼‰ï¼š
- åˆ‡æ¢æ—¶é—´ï¼š~300-600msï¼ˆåŒ…æ‹¬åŠ¨ç”»æ—¶é•¿ï¼‰
- ç”¨æˆ·ä½“éªŒï¼šæµç•…
```

#### ä¼˜åŒ–å»ºè®®

**1. å‡å°‘åˆ†æ”¯å¤æ‚åº¦**

âŒ ä¸æ¨èï¼š
```typescript
if (this.condition) {
  Column() {
    ForEach(this.largeArray, (item) => {
      ComplexItem({ item })  // å¤æ‚ç»„ä»¶
    })
  }
}
```

âœ… æ¨èï¼š
```typescript
// ä½¿ç”¨ LazyForEach æ›¿ä»£
if (this.condition) {
  List() {
    LazyForEach(this.dataSource, (item) => {
      ListItem() {
        ComplexItem({ item })
      }
    })
  }
}
```

**2. é¿å…é¢‘ç¹åˆ‡æ¢**

âŒ ä¸æ¨èï¼š
```typescript
@State toggle: boolean = false

// æ¯ 100ms åˆ‡æ¢ä¸€æ¬¡
aboutToAppear() {
  setInterval(() => {
    this.toggle = !this.toggle
  }, 100)
}
```

âœ… æ¨èï¼š
```typescript
// ä½¿ç”¨åŠ¨ç”»è¿‡æ¸¡ï¼Œé™ä½è§†è§‰çªå˜
if (this.toggle) {
  Column() { ... }
  .transition({ type: TransitionType.All, opacity: 0 })
}
```

### èŠ‚ç‚¹å¤ç”¨ä¼˜åŒ–

#### å¤ç”¨æ€§èƒ½å¯¹æ¯”

```
åœºæ™¯ï¼šåˆ‡æ¢åŒ…å« 100 ä¸ª ListItem çš„åˆ†æ”¯

ä¸å¤ç”¨ï¼š
- åˆ›å»º 100 ä¸ª ListItemï¼š~500ms
- é”€æ¯ 100 ä¸ª ListItemï¼š~200ms
- æ€»è®¡ï¼š~700ms

å¤ç”¨ï¼š
- TryRetake æŸ¥æ‰¾ï¼š~10ms
- é‡æ–°æ¿€æ´» 100 ä¸ª ListItemï¼š~50ms
- æ€»è®¡ï¼š~60ms

æ€§èƒ½æå‡ï¼š~90%
```

#### ä¼˜åŒ–ç­–ç•¥

**1. ä¸ºéœ€è¦å¤ç”¨çš„ç»„ä»¶è®¾ç½®å›ºå®š ID**

```typescript
if (this.showPanel) {
  Column() {
    TextInput({ text: this.input })
      .id('fixedInput')  // å›ºå®š ID

    List() {
      ForEach(this.items, (item) => {
        ListItem() { Text(item) }
      })
    }
    .id('fixedList')  // å›ºå®š ID
  }
  .id('fixedColumn')  // å›ºå®š ID
}
```

**2. é¿å…åŠ¨æ€ç”Ÿæˆçš„ ID**

âŒ ä¸æ¨èï¼š
```typescript
ForEach(this.items, (item, index) => {
  Text(item)
    .id(`text_${index}_${Date.now()}`)  // æ¯æ¬¡ç”Ÿæˆéƒ½ä¸åŒ
})
```

âœ… æ¨èï¼š
```typescript
ForEach(this.items, (item) => {
  Text(item)
    .id(`text_${item.id}`)  // ä½¿ç”¨æ•°æ®ä¸­çš„å›ºå®š ID
})
```

### åŠ¨ç”»ä¼˜åŒ–å»ºè®®

#### geometryTransition ä¼˜åŒ–

**é€‚ç”¨åœºæ™¯**ï¼š
- åˆ†æ”¯åˆ‡æ¢æ—¶ä½ç½®ã€å°ºå¯¸å˜åŒ–
- éœ€è¦å¹³æ»‘è¿‡æ¸¡æ•ˆæœ

**æ€§èƒ½è€ƒè™‘**ï¼š
- geometryTransition ä¼šè§¦å‘é¢å¤–çš„å¸ƒå±€è®¡ç®—
- å¤æ‚ç»„ä»¶å¯èƒ½å½±å“æ€§èƒ½

**ç¤ºä¾‹**ï¼š

```typescript
@State expanded: boolean = false

if (this.expanded) {
  Column() {
    Text('Expanded content')
      .fontSize(20)
  }
  .width('100%')
  .height(200)
  .geometryTransition('expandingPanel')  // å¯ç”¨å‡ ä½•è¿‡æ¸¡
} else {
  Column() {
    Text('Collapsed content')
      .fontSize(14)
  }
  .width('100%')
  .height(50)
  .geometryTransition('expandingPanel')  // ç›¸åŒ ID
}
```

#### transition åŠ¨ç”»ä¼˜åŒ–

**é€‚ç”¨åœºæ™¯**ï¼š
- å…¥åœº/å‡ºåœºåŠ¨ç”»
- é€æ˜åº¦ã€æ—‹è½¬ç­‰æ•ˆæœ

**ç¤ºä¾‹**ï¼š

```typescript
if (this.visible) {
  Text('Hello')
    .fontSize(30)
    .transition({ type: TransitionType.Insert, opacity: 0 })
    .animation({ duration: 300, curve: Curve.EaseInOut })
} else {
  Text()  // ç©ºèŠ‚ç‚¹
}
```

**æ€§èƒ½å»ºè®®**ï¼š
- é¿å…åŒæ—¶ä½¿ç”¨å¤šä¸ªå¤æ‚åŠ¨ç”»
- é™åˆ¶åŠ¨ç”»å¸§ç‡ï¼ˆå¦‚æœå¯èƒ½ï¼‰
- ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„å±æ€§ï¼ˆtransform > opacity > width/heightï¼‰

---

## å¸¸è§é—®é¢˜

### åˆ†æ”¯åˆ‡æ¢ä¸ç”Ÿæ•ˆ

#### é—®é¢˜ 1ï¼šæ¡ä»¶å˜é‡æœªè§¦å‘æ›´æ–°

**ç—‡çŠ¶**ï¼š
- ä¿®æ”¹æ¡ä»¶å˜é‡åï¼ŒUI ä¸æ›´æ–°

**åŸå› **ï¼š
- æ¡ä»¶å˜é‡æœªä½¿ç”¨ `@State` è£…é¥°
- æ¡ä»¶è¡¨è¾¾å¼æœªä¾èµ– `@State` å˜é‡

**è§£å†³æ–¹æ¡ˆ**ï¼š

âŒ é”™è¯¯ï¼š
```typescript
toggle: boolean = false  // ç¼ºå°‘ @State

if (this.toggle) {
  Text('On')
}
```

âœ… æ­£ç¡®ï¼š
```typescript
@State toggle: boolean = false  // æ·»åŠ  @State

if (this.toggle) {
  Text('On')
}
```

#### é—®é¢˜ 2ï¼šæ¡ä»¶è¡¨è¾¾å¼ä¾èµ–éå“åº”å¼å˜é‡

**ç—‡çŠ¶**ï¼š
- ä¾èµ–çš„å˜é‡å˜åŒ–ï¼Œä½†æ¡ä»¶ä¸é‡æ–°è¯„ä¼°

**åŸå› **ï¼š
- æ¡ä»¶è¡¨è¾¾å¼ä¸­çš„å˜é‡ä¸æ˜¯å“åº”å¼çš„

**è§£å†³æ–¹æ¡ˆ**ï¼š

âŒ é”™è¯¯ï¼š
```typescript
private counter: number = 0  // é @State

@State toggle: boolean = false

if (this.counter > 10) {  // counter å˜åŒ–ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
  Text('Counter > 10')
}
```

âœ… æ­£ç¡®ï¼š
```typescript
@State counter: number = 0  // ä½¿ç”¨ @State

if (this.counter > 10) {  // counter å˜åŒ–ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
  Text('Counter > 10')
}
```

### çŠ¶æ€ä¸¢å¤±é—®é¢˜

#### é—®é¢˜ 1ï¼šè¾“å…¥æ¡†å†…å®¹ä¸¢å¤±

**ç—‡çŠ¶**ï¼š
- åˆ‡æ¢åˆ†æ”¯åï¼Œè¾“å…¥æ¡†å†…å®¹è¢«æ¸…ç©º

**åŸå› **ï¼š
- æœªä¸ºè¾“å…¥æ¡†è®¾ç½®å›ºå®š ID
- å‰ç«¯æ— æ³•å¤ç”¨èŠ‚ç‚¹

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
if (this.showInput) {
  TextInput({ text: this.inputValue })
    .id('myInput')  // å…³é”®ï¼šè®¾ç½®å›ºå®š ID
    .onChange((value: string) => {
      this.inputValue = value
    })
}
```

#### é—®é¢˜ 2ï¼šæ»šåŠ¨ä½ç½®ä¸¢å¤±

**ç—‡çŠ¶**ï¼š
- åˆ‡æ¢ Tab åï¼ŒList æ»šåŠ¨ä½ç½®é‡ç½®

**åŸå› **ï¼š
- List æœªè®¾ç½®å›ºå®š ID
- æ¯æ¬¡åˆ‡æ¢éƒ½åˆ›å»ºæ–°çš„ List å®ä¾‹

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
if (this.currentTab === 0) {
  List() {
    ForEach(this.items, (item) => {
      ListItem() { Text(item) }
    })
  }
  .id('tab0List')  // å…³é”®ï¼šä¸ºæ¯ä¸ª Tab çš„ List è®¾ç½®å”¯ä¸€ ID
}
```

### æ€§èƒ½é—®é¢˜

#### é—®é¢˜ 1ï¼šåˆ†æ”¯åˆ‡æ¢å¡é¡¿

**ç—‡çŠ¶**ï¼š
- åˆ†æ”¯åˆ‡æ¢æ—¶ UI å¡é¡¿

**åŸå› **ï¼š
- åˆ†æ”¯å†…å®¹è¿‡äºå¤æ‚
- åŒ…å«å¤§é‡å­ç»„ä»¶æˆ–åˆ—è¡¨

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ LazyForEach**

```typescript
if (this.showList) {
  List() {
    LazyForEach(this.dataSource, (item) => {
      ListItem() {
        ComplexItem({ item })
      }
    })
  }
}
```

**æ–¹æ¡ˆ 2ï¼šä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨**

```typescript
if (this.showList) {
  List() {
    RepeatVirtualScroll(this.items)  // API 16+
      .itemCount(this.items.length)
      .itemCreator((index) => {
        ListItem() { Text(this.items[index]) }
      })
  }
}
```

**æ–¹æ¡ˆ 3ï¼šæ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨**

```typescript
@State isLoading: boolean = false
@State showContent: boolean = false

async toggleContent() {
  this.isLoading = true
  this.showContent = !this.showContent

  // ç­‰å¾…ä¸‹ä¸€å¸§
  await new Promise(resolve => setTimeout(resolve, 0))

  this.isLoading = false
}

if (this.isLoading) {
  LoadingProgress()
} else if (this.showContent) {
  Content()
}
```

#### é—®é¢˜ 2ï¼šå†…å­˜å ç”¨è¿‡é«˜

**ç—‡çŠ¶**ï¼š
- åº”ç”¨å†…å­˜å ç”¨æŒç»­å¢é•¿
- å¤šæ¬¡åˆ‡æ¢åˆ†æ”¯åå†…å­˜æ³„æ¼

**åŸå› **ï¼š
- åˆ†æ”¯èŠ‚ç‚¹æœªæ­£ç¡®é”€æ¯
- TryRetain ä¿ç•™çš„èŠ‚ç‚¹æœªé‡Šæ”¾

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ 1ï¼šé¿å…ä¸å¿…è¦çš„å¤ç”¨**

```typescript
// å¦‚æœä¸éœ€è¦ä¿ç•™çŠ¶æ€ï¼Œè®©èŠ‚ç‚¹æ­£å¸¸é”€æ¯
if (this.showPanel) {
  Panel() { ... }
  // ä¸è®¾ç½® IDï¼Œä¸ä½¿ç”¨ TryRetake
}
```

**æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨æ¸…ç†çŠ¶æ€**

```typescript
@State showPanel: boolean = false

aboutToDisappear() {
  // ç»„ä»¶é”€æ¯æ—¶æ¸…ç†çŠ¶æ€
  this.inputValue = ''
  this.scrollOffset = 0
}
```

### åŠ¨ç”»é—®é¢˜

#### é—®é¢˜ 1ï¼šåŠ¨ç”»ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**ï¼š
- åˆ†æ”¯åˆ‡æ¢æ—¶åŠ¨ç”»ä¸æ’­æ”¾

**åŸå› **ï¼š
- æœªè®¾ç½® `transition` æˆ– `geometryTransition`
- åŠ¨ç”»é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
if (this.showContent) {
  Column() {
    Text('Content')
  }
  .transition({
    type: TransitionType.All,
    opacity: 0,
    translate: { x: 100 }
  })
  .animation({
    duration: 300,
    curve: Curve.EaseInOut
  })
}
```

#### é—®é¢˜ 2ï¼šå‡ ä½•è¿‡æ¸¡ä¸æµç•…

**ç—‡çŠ¶**ï¼š
- geometryTransition åŠ¨ç”»å¡é¡¿

**åŸå› **ï¼š
- åˆ†æ”¯å†…å®¹å·®å¼‚è¿‡å¤§
- åŒ…å«å¤æ‚å¸ƒå±€è®¡ç®—

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ 1ï¼šç®€åŒ–åˆ†æ”¯å†…å®¹**

```typescript
// ç¡®ä¿ä¸¤ä¸ªåˆ†æ”¯çš„ç»“æ„ç›¸ä¼¼
if (this.expanded) {
  Column() {
    Text('Title')
    Text('Description')
  }
  .height(200)
  .geometryTransition('panel')
} else {
  Column() {
    Text('Title')
    // ç§»é™¤ Descriptionï¼Œä¿æŒç»“æ„ç›¸ä¼¼
  }
  .height(50)
  .geometryTransition('panel')
}
```

**æ–¹æ¡ˆ 2ï¼šç¦ç”¨éƒ¨åˆ†å±æ€§çš„åŠ¨ç”»**

```typescript
Column() {
  Text('Content')
}
.geometryTransition('panel')
.animation({
  duration: 300,
  curve: Curve.EaseInOut
})
// é¿å… width/height å˜åŒ–ï¼Œåªä½¿ç”¨ opacity/transform
```

---

## ä¸ if-else è¯­æ³•å¯¹æ¯”

### ArkTS if-else è¯­æ³• vs JavaScript if-else

| ç‰¹æ€§ | ArkTS if-else | JavaScript if-else |
|------|--------------|-------------------|
| **è¯­æ³•** | å£°æ˜å¼ UI æ„é€  | è¯­å¥çº§æ§åˆ¶æµ |
| **ç¼–è¯‘** | ç¼–è¯‘æ—¶è½¬æ¢ä¸ºç»„ä»¶æ ‘ | è¿è¡Œæ—¶æ‰§è¡Œ |
| **çŠ¶æ€ç®¡ç†** | è‡ªåŠ¨ä¾èµ– `@State` å˜é‡ | æ— çŠ¶æ€ç®¡ç† |
| **æ€§èƒ½ä¼˜åŒ–** | æ™ºèƒ½å·®é‡æ›´æ–°ã€èŠ‚ç‚¹å¤ç”¨ | æ¯æ¬¡é‡æ–°æ‰§è¡Œ |
| **åŠ¨ç”»æ”¯æŒ** | å†…ç½® `transition`ã€`geometryTransition` | éœ€æ‰‹åŠ¨å®ç° |

### ä¸å…¶ä»–æ¡ä»¶æ¸²æŸ“æ–¹æ¡ˆå¯¹æ¯”

#### æ–¹æ¡ˆ 1ï¼šif-else vs visibility

| ç‰¹æ€§ | if-else | visibility |
|------|---------|-----------|
| **æ¸²æŸ“æ–¹å¼** | æ¡ä»¶æ¸²æŸ“ï¼ˆåˆ›å»º/é”€æ¯ï¼‰ | å¯è§æ€§åˆ‡æ¢ |
| **å†…å­˜å ç”¨** | ä½ï¼ˆä¸æ¸²æŸ“æ—¶ä¸å ç”¨ï¼‰ | é«˜ï¼ˆå§‹ç»ˆå ç”¨ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | äº’æ–¥çš„åˆ†æ”¯ | é¢‘ç¹åˆ‡æ¢çš„å†…å®¹ |
| **çŠ¶æ€ä¿ç•™** | é€šè¿‡ TryRetake | è‡ªåŠ¨ä¿ç•™ |

**if-else é€‚åˆ**ï¼š
- äº’æ–¥çš„åˆ†æ”¯ï¼ˆåŒä¸€æ—¶é—´åªæ˜¾ç¤ºä¸€ä¸ªï¼‰
- åˆ†æ”¯å†…å®¹å·®å¼‚å¤§
- éœ€è¦é‡Šæ”¾å†…å­˜

**visibility é€‚åˆ**ï¼š
- é¢‘ç¹åˆ‡æ¢çš„å†…å®¹
- éœ€è¦ä¿ç•™çŠ¶æ€
- å†…å®¹å·®å¼‚å°

#### æ–¹æ¡ˆ 2ï¼šif-else vs switch

**ArkTS æ²¡æœ‰ç›´æ¥çš„ switch è¯­æ³•**ï¼Œä½†å¯ä»¥ä½¿ç”¨å¤šå±‚ if-elseif-else æ¨¡æ‹Ÿï¼š

```typescript
// æ¨¡æ‹Ÿ switch
if (this.value === 1) {
  Content1()
} else if (this.value === 2) {
  Content2()
} else if (this.value === 3) {
  Content3()
} else {
  DefaultContent()
}
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
- switchï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼šO(1) è·³è½¬
- if-elseif-elseï¼šO(n) é¡ºåºåˆ¤æ–­

**å»ºè®®**ï¼š
- åˆ†æ”¯è¾ƒå°‘ï¼ˆ< 5 ä¸ªï¼‰ï¼šä½¿ç”¨ if-elseif-else
- åˆ†æ”¯è¾ƒå¤šï¼ˆâ‰¥ 5 ä¸ªï¼‰ï¼šè€ƒè™‘ä½¿ç”¨ Map æˆ–å¯¹è±¡æŸ¥æ‰¾

---

## é™„å½•

### æºç æ–‡ä»¶æ¸…å•

#### æ ¸å¿ƒå±‚

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `if_else_node.h` | `frameworks/core/components_ng/syntax/if_else_node.h` | IfElseNode å¤´æ–‡ä»¶ |
| `if_else_node.cpp` | `frameworks/core/components_ng/syntax/if_else_node.cpp` | IfElseNode å®ç° |
| `if_else_model.h` | `frameworks/core/components_ng/syntax/if_else_model.h` | Model æ¥å£å®šä¹‰ |
| `if_else_model_ng.h` | `frameworks/core/components_ng/syntax/if_else_model_ng.h` | NG Model å¤´æ–‡ä»¶ |
| `if_else_model_ng.cpp` | `frameworks/core/components_ng/syntax/if_else_model_ng.cpp` | NG Model å®ç° |

#### æ¡¥æ¥å±‚ - å£°æ˜å¼å‰ç«¯

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `js_if_else.h` | `frameworks/bridge/declarative_frontend/jsview/js_if_else.h` | JSIfElse å¤´æ–‡ä»¶ |
| `js_if_else.cpp` | `frameworks/bridge/declarative_frontend/jsview/js_if_else.cpp` | JSIfElse å®ç° |

#### æ¡¥æ¥å±‚ - CJ å‰ç«¯

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `cj_if_else_ffi.h` | `frameworks/bridge/cj_frontend/interfaces/cj_ffi/cj_if_else_ffi.h` | CJ FFI å¤´æ–‡ä»¶ |
| `cj_if_else_ffi.cpp` | `frameworks/bridge/cj_frontend/interfaces/cj_ffi/cj_if_else_ffi.cpp` | CJ FFI å®ç° |

### å…³é”®æ–¹æ³•é€ŸæŸ¥è¡¨

| æ–¹æ³• | ä½ç½® | åŠŸèƒ½ |
|------|------|------|
| `SetBranchId()` | `if_else_node.cpp:65-78` | è®¾ç½®åˆ†æ”¯ IDï¼Œè§¦å‘åˆ†æ”¯åˆ‡æ¢ |
| `FlushUpdateAndMarkDirty()` | `if_else_node.cpp:80-96` | åˆ·æ–°å¹¶æ ‡è®°è„çŠ¶æ€ |
| `TryRetake()` | `if_else_node.cpp:98-111` | å°è¯•å¤ç”¨ä¹‹å‰åˆ†æ”¯çš„èŠ‚ç‚¹ |
| `CollectRetakenNodes()` | `if_else_node.cpp:113-121` | æ”¶é›†è¢«å¤ç”¨çš„èŠ‚ç‚¹ ID |
| `GetRetakenElmtIds()` | `if_else_node.cpp:123-130` | è·å–å¤ç”¨èŠ‚ç‚¹ ID åˆ—è¡¨ |
| `Clean()` | `ui_node.cpp` | æ¸…ç†å­èŠ‚ç‚¹ï¼ˆUINode åŸºç±»æ–¹æ³•ï¼‰ |
| `GetDisappearingChildById()` | `ui_node.cpp` | ä»æ¶ˆå¤±é˜Ÿåˆ—è·å–èŠ‚ç‚¹ |
| `CollectCleanedChildren()` | `ui_node.cpp` | æ”¶é›†å·²æ¸…ç†çš„å­èŠ‚ç‚¹ |

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨ ACE_IF æ—¥å¿—æ ‡ç­¾

```cpp
// åœ¨ if_else_node.cpp ä¸­å·²æœ‰æ—¥å¿—
TAG_LOGD(AceLogTag::ACE_IF, "IfElse(%{public}d).SetBranchId branchIdChanged_: %{public}d",
    GetId(), branchIdChanged_);
```

**å¦‚ä½•æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
# ä½¿ç”¨ hidumper æŸ¥çœ‹æ—¥å¿—
hdc shell hidumper -s AceEditor -a -d

# è¿‡æ»¤ ACE_IF æ ‡ç­¾
hdc shell "hilog | grep ACE_IF"
```

#### 2. ä½¿ç”¨ DevEco Studio è°ƒè¯•

**æ–­ç‚¹ä½ç½®**ï¼š
- `SetBranchId()`ï¼šæŸ¥çœ‹åˆ†æ”¯åˆ‡æ¢é€»è¾‘
- `TryRetake()`ï¼šæŸ¥çœ‹èŠ‚ç‚¹å¤ç”¨æƒ…å†µ
- `FlushUpdateAndMarkDirty()`ï¼šæŸ¥çœ‹åˆ·æ–°æµç¨‹

**è°ƒè¯•ä¿¡æ¯**ï¼š
```typescript
// åœ¨ ArkTS ä¸­æ·»åŠ æ—¥å¿—
if (this.condition) {
  console.log('Branch 0 activated')
  Text('Branch 0')
}
```

#### 3. ä½¿ç”¨ Inspector å·¥å…·

```bash
# æŸ¥çœ‹ UI æ ‘ç»“æ„
hdc shell hidumper -s WindowManagerService -a -d

# æŸ¥çœ‹ç»„ä»¶ä¿¡æ¯
hdc shell aa dump -a
```

### æ€§èƒ½åˆ†æ

#### ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·

```typescript
// ä½¿ç”¨ @Trace è£…é¥°å™¨è¿½è¸ªæ€§èƒ½
import { Trace } from '@kit.PerformanceAnalysisKit'

@Entry
@Component
struct MyComponent {
  @State condition: boolean = false

  build() {
    Column() {
      if (this.condition) {
        // Trace.startTrace('branch0')
        ExpensiveContent()
        // Trace.stopTrace('branch0')
      }
    }
  }
}
```

#### æ€§èƒ½æŒ‡æ ‡

**å…³é”®æŒ‡æ ‡**ï¼š
- **åˆ†æ”¯åˆ‡æ¢æ—¶é—´**ï¼šç›®æ ‡ < 100ms
- **å†…å­˜å ç”¨**ï¼šç›®æ ‡ < 10MB/åˆ†æ”¯
- **åŠ¨ç”»å¸§ç‡**ï¼šç›®æ ‡ 60 FPS

**ä¼˜åŒ–å»ºè®®**ï¼š
- å‡å°‘åˆ†æ”¯å¤æ‚åº¦
- ä½¿ç”¨èŠ‚ç‚¹å¤ç”¨
- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨

### ç›¸å…³æ–‡æ¡£

- **å¾ªç¯ç»„ä»¶**ï¼š[Loop_Components_Family.md](Loop_Components_Family.md) - ForEachã€LazyForEach ç­‰
- **çŠ¶æ€ç®¡ç†**ï¼š`../../bridge/declarative_frontend/state_mgmt/` - AppStorageã€LocalStorage
- **æ€§èƒ½ä¼˜åŒ–**ï¼š`docs/best_practices/` - æ€§èƒ½ä¼˜åŒ–æŒ‡å—
- **åŠ¨ç”»ç³»ç»Ÿ**ï¼š`docs/pattern/animation/` - åŠ¨ç”»å®Œæ•´æŒ‡å—

### å‚è€ƒèµ„æº

- **ArkTS å®˜æ–¹æ–‡æ¡£**ï¼šhttps://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-conditional-rendering-V5
- **OpenHarmony æºç **ï¼šhttps://gitee.com/openharmony/arkui_ace_engine
- **ACE Engine CLAUDE.md**ï¼š`/mnt/data/w30045790/code/foundation/arkui/ace_engine/CLAUDE.md`

---

**æ–‡æ¡£ç»“æŸ**

å¦‚æœ‰ç–‘é—®æˆ–éœ€è¦è¡¥å……ï¼Œè¯·å‚è€ƒæºç æˆ–è”ç³» ACE Engine å›¢é˜Ÿã€‚
